
{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <h4 class="text-primary mb-3">All Teacher Work Plans</h4>

  <!-- Filters -->
  <form class="card mb-3 shadow-sm" method="get" action="{{ url_for('workplans_all') }}">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Teacher</label>
          <select name="teacher_id" class="form-select">
            <option value="">All teachers</option>
            {% for t in teachers %}
            <option value="{{ t.id }}"
                    {% if current_teacher_id == t.id %}selected{% endif %}>
              {{ t.first_name }} {{ t.last_name }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label">Class</label>
          <select name="class_name" class="form-select">
            <option value="ALL">All classes</option>
            {% for c in classes %}
            <option value="{{ c }}"
                    {% if current_class == c %}selected{% endif %}>
              {{ c }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-2">
          <label class="form-label">Term</label>
          <select name="term" class="form-select">
            <option value="ALL" {% if current_term == 'ALL' %}selected{% endif %}>All</option>
            <option value="Term 1" {% if current_term == 'Term 1' %}selected{% endif %}>Term 1</option>
            <option value="Term 2" {% if current_term == 'Term 2' %}selected{% endif %}>Term 2</option>
            <option value="Term 3" {% if current_term == 'Term 3' %}selected{% endif %}>Term 3</option>
          </select>
        </div>

        <div class="col-md-2">
          <label class="form-label">Week</label>
          <select name="week" class="form-select">
            <option value="ALL" {% if current_week == 'ALL' %}selected{% endif %}>All weeks</option>
            {% for w in range(1, 15) %}
            {% set label = 'Week ' ~ w %}
            <option value="{{ label }}"
                    {% if current_week == label %}selected{% endif %}>
              {{ label }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">Filter</button>
        </div>
      </div>

      <div class="mt-3 text-end">
        <a href="{{ url_for('workplans_all', teacher_id=current_teacher_id,
                             class_name=current_class, term=current_term,
                             week=current_week, export='pdf') }}"
           class="btn btn-sm btn-outline-dark">
          Export Result (PDF)
        </a>
      </div>
    </div>
  </form>

  <!-- Table -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-sm table-striped mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>Date</th>
              <th>Teacher</th>
              <th>Class</th>
              <th>Period</th>
              <th>Planned activities</th>
              <th>Status</th>
              <th>Comment</th>
            </tr>
          </thead>
          <tbody>
            {% if rows %}
              {% for p in rows %}
              <tr>
                <td>{{ p.plan_date.strftime('%Y-%m-%d') if p.plan_date else '' }}</td>
                <td>
                  {{ p.first_name }} {{ p.last_name }}
                  <div class="small text-muted">
                    {{ p.department }}
                  </div>
                </td>
                <td>
                  {{ p.class_name or 'All' }}
                  {% if p.stream %} ({{ p.stream }}){% endif %}
                  <div class="small text-muted">
                    {{ p.term }}{% if p.week_label %}, {{ p.week_label }}{% endif %}
                  </div>
                </td>
                <td>{{ p.period_from }} - {{ p.period_to }}</td>
                <td>
                  <span class="d-inline-block text-truncate" style="max-width: 260px;">
                    {{ p.planned_activities }}
                  </span>
                </td>
                <td>
                  {% if p.status == 'done' %}
                    <span class="badge bg-success">Done</span>
                  {% elif p.status == 'not_done' %}
                    <span class="badge bg-danger">Not done</span>
                  {% else %}
                    <span class="badge bg-warning text-dark">Pending</span>
                  {% endif %}
                </td>
                <td>
                  <span class="d-inline-block text-truncate" style="max-width: 220px;">
                    {{ p.comment }}
                  </span>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="7" class="text-center py-3 text-muted">
                  No work plans for the selected filters.
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% endblock %}
